<div class="space-y-6">
  <!-- 페이지 헤더 -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-black text-gray-900"><%= @race.title %> - 참가자 관리</h1>
      <p class="text-gray-500 font-medium mt-2">참가자 명단을 조회하고 관리할 수 있습니다</p>
    </div>
    <div class="flex items-center gap-3">
      <%= link_to "← 대회 상세", organizer_race_path(@race), class: "text-sm font-bold text-gray-600 hover:text-gray-900" %>
      <%= link_to organizer_race_participants_path(@race, format: :csv,
                    edition_id: params[:edition_id],
                    gender: params[:gender],
                    age_group: params[:age_group],
                    query: params[:query]),
                  class: "px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition-colors shadow-md hover:shadow-lg flex items-center gap-2",
                  data: { turbo: false } do %>
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        CSV 다운로드
      <% end %>
    </div>
  </div>

  <!-- 필터 및 검색 -->
  <div class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
    <%= form_with url: organizer_race_participants_path(@race), method: :get, class: "grid grid-cols-1 md:grid-cols-5 gap-4" do |f| %>
      <!-- 종목 필터 -->
      <div>
        <%= f.label :edition_id, '종목', class: "block text-sm font-bold text-gray-700 mb-2" %>
        <%= f.select :edition_id,
            options_from_collection_for_select(@race.race_editions, :id, :name, params[:edition_id]),
            { include_blank: '전체' },
            class: 'w-full px-4 py-2 border border-gray-300 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent' %>
      </div>

      <!-- 성별 필터 -->
      <div>
        <%= f.label :gender, '성별', class: "block text-sm font-bold text-gray-700 mb-2" %>
        <%= f.select :gender,
            options_for_select([['남성', 'male'], ['여성', 'female']], params[:gender]),
            { include_blank: '전체' },
            class: 'w-full px-4 py-2 border border-gray-300 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent' %>
      </div>

      <!-- 연령대 필터 -->
      <div>
        <%= f.label :age_group, '연령대', class: "block text-sm font-bold text-gray-700 mb-2" %>
        <%= f.select :age_group,
            options_for_select(%w[10대 20대 30대 40대 50대 60대이상], params[:age_group]),
            { include_blank: '전체' },
            class: 'w-full px-4 py-2 border border-gray-300 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent' %>
      </div>

      <!-- 검색 -->
      <div>
        <%= f.label :query, '검색', class: "block text-sm font-bold text-gray-700 mb-2" %>
        <%= f.text_field :query,
            placeholder: '이름 또는 이메일',
            value: params[:query],
            class: 'w-full px-4 py-2 border border-gray-300 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent' %>
      </div>

      <!-- 버튼 -->
      <div class="flex items-end gap-2">
        <%= f.submit '필터 적용', class: 'px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition-colors' %>
        <%= link_to '초기화', organizer_race_participants_path(@race), class: 'px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-lg transition-colors' %>
      </div>
    <% end %>
  </div>

  <!-- 통계 -->
  <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-4">
    <div class="flex items-center gap-2">
      <svg class="w-5 h-5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <p class="text-indigo-900 font-bold">
        총 <span class="text-2xl"><%= @registrations.total_count %></span>명의 참가자
        <% if params[:edition_id].present? || params[:gender].present? || params[:age_group].present? || params[:query].present? %>
          <span class="text-indigo-600">(필터 적용됨)</span>
        <% end %>
      </p>
    </div>
  </div>

  <!-- 참가자 테이블 -->
  <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">등번호</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">참가자명</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">성별</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">연령대</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">종목</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">전화번호</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">이메일</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">신청일</th>
            <th class="px-6 py-4 text-left text-xs font-black text-gray-600 uppercase tracking-wider">상세</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <% @registrations.each do |reg| %>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4">
                <span class="inline-flex items-center justify-center w-10 h-10 bg-indigo-100 text-indigo-800 font-black rounded-lg">
                  <%= reg.bib_number %>
                </span>
              </td>
              <td class="px-6 py-4 font-bold text-gray-900"><%= reg.user.name %></td>
              <td class="px-6 py-4">
                <% if reg.user.gender == 'male' %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-100 text-blue-800">남성</span>
                <% elsif reg.user.gender == 'female' %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-pink-100 text-pink-800">여성</span>
                <% else %>
                  <span class="text-gray-400">-</span>
                <% end %>
              </td>
              <td class="px-6 py-4 text-gray-600"><%= reg.user.age_group || '-' %></td>
              <td class="px-6 py-4 font-medium text-gray-900"><%= reg.race_edition.name %></td>
              <td class="px-6 py-4 text-gray-600"><%= reg.user.phone || '-' %></td>
              <td class="px-6 py-4 text-gray-600 text-sm"><%= reg.user.email %></td>
              <td class="px-6 py-4 text-sm text-gray-500"><%= reg.created_at.strftime('%Y-%m-%d') %></td>
              <td class="px-6 py-4">
                <%= link_to organizer_race_participant_path(@race, reg), class: "text-indigo-600 hover:text-indigo-800 font-bold text-sm" do %>
                  상세 →
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <% if @registrations.empty? %>
        <div class="p-12 text-center">
          <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <p class="text-gray-500 font-medium">
            <% if params[:edition_id].present? || params[:gender].present? || params[:age_group].present? || params[:query].present? %>
              검색 조건에 맞는 참가자가 없습니다
            <% else %>
              아직 참가자가 없습니다
            <% end %>
          </p>
        </div>
      <% end %>
    </div>

    <!-- 페이지네이션 -->
    <% if @registrations.any? %>
      <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
        <%= paginate @registrations, theme: 'twitter-bootstrap-4' %>
      </div>
    <% end %>
  </div>
</div>
